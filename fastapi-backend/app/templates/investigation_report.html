<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT Investigation Report - {{ investigation.target }}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm 1.5cm;
            @top-center {
                content: "OSINT Investigation Report - {{ investigation.target }}";
                font-family: 'Arial', sans-serif;
                font-size: 10pt;
                color: #666;
            }
            @bottom-center {
                content: "Page " counter(page) " of " counter(pages);
                font-family: 'Arial', sans-serif;
                font-size: 10pt;
                color: #666;
            }
        }
        
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 24pt;
            font-weight: bold;
        }
        
        .header .subtitle {
            font-size: 14pt;
            opacity: 0.9;
        }
        
        .metadata {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .metadata-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .metadata-item {
            margin-bottom: 10px;
        }
        
        .metadata-label {
            font-weight: bold;
            color: #374151;
            display: inline-block;
            min-width: 120px;
        }
        
        .metadata-value {
            color: #1f2937;
        }
        
        .section {
            margin-bottom: 30px;
            break-inside: avoid;
        }
        
        .section-title {
            background: #374151;
            color: white;
            padding: 12px 20px;
            margin: 0 0 20px 0;
            font-size: 16pt;
            font-weight: bold;
            border-radius: 6px;
        }
        
        .risk-score {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14pt;
        }
        
        .risk-minimal { background: #dcfce7; color: #166534; }
        .risk-low { background: #fef3c7; color: #92400e; }
        .risk-medium { background: #fed7aa; color: #c2410c; }
        .risk-high { background: #fecaca; color: #dc2626; }
        .risk-critical { background: #fda4af; color: #be123c; }
        
        .findings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .finding-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .finding-title {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 10px;
            text-transform: capitalize;
        }
        
        .finding-content {
            color: #4b5563;
            font-size: 10pt;
        }
        
        .error-list {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .error-item {
            color: #dc2626;
            margin-bottom: 5px;
            font-size: 10pt;
        }
        
        .summary-box {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .investigation-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            text-align: center;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
        }
        
        .stat-value {
            font-size: 18pt;
            font-weight: bold;
            color: #1e40af;
            display: block;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 10pt;
            margin-top: 5px;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
            text-align: center;
            color: #6b7280;
            font-size: 10pt;
        }
        
        .disclaimer {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            font-size: 9pt;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>OSINT Investigation Report</h1>
        <div class="subtitle">{{ investigation.target }}</div>
    </div>
    
    <div class="metadata">
        <div class="metadata-grid">
            <div>
                <div class="metadata-item">
                    <span class="metadata-label">Target:</span>
                    <span class="metadata-value">{{ investigation.target }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Investigation ID:</span>
                    <span class="metadata-value">{{ investigation.id }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Investigation Type:</span>
                    <span class="metadata-value">{{ investigation.investigation_type|title }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Status:</span>
                    <span class="metadata-value">{{ investigation.status|title }}</span>
                </div>
            </div>
            <div>
                <div class="metadata-item">
                    <span class="metadata-label">Created:</span>
                    <span class="metadata-value">{{ created_date }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Completed:</span>
                    <span class="metadata-value">{{ completed_date if completed_date else 'In Progress' }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Duration:</span>
                    <span class="metadata-value">{{ duration }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Investigator:</span>
                    <span class="metadata-value">{{ user_email }}</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h2 class="section-title">Executive Summary</h2>
        <div class="summary-box">
            <div style="margin-bottom: 15px;">
                <strong>Risk Assessment:</strong>
                <span class="risk-score risk-{{ risk_level }}">{{ investigation.summary or 'Assessment Pending' }}</span>
            </div>
            {% if investigation.risk_score is not none %}
            <div>
                <strong>Risk Score:</strong> {{ investigation.risk_score }}/100
            </div>
            {% endif %}
        </div>
        
        <div class="investigation-stats">
            <div class="stat-card">
                <span class="stat-value">{{ findings_count }}</span>
                <div class="stat-label">Data Points Collected</div>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ investigation.risk_score or 0 }}</span>
                <div class="stat-label">Risk Score</div>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ error_count }}</span>
                <div class="stat-label">Collection Errors</div>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ duration }}</span>
                <div class="stat-label">Processing Time</div>
            </div>
        </div>
    </div>
    
    {% if investigation.findings %}
    <div class="section">
        <h2 class="section-title">Investigation Findings</h2>
        <div class="findings-grid">
            {% for category, data in investigation.findings.items() %}
            <div class="finding-card">
                <div class="finding-title">{{ category|replace('_', ' ')|title }} Intelligence</div>
                <div class="finding-content">
                    {% if data %}
                        {% for key, value in data.items() %}
                        <strong>{{ key|replace('_', ' ')|title }}:</strong> {{ value }}<br>
                        {% endfor %}
                    {% else %}
                        No significant findings in this category.
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    {% if investigation.errors %}
    <div class="section">
        <h2 class="section-title">Collection Limitations</h2>
        <div class="error-list">
            <strong>The following data sources were unavailable during this investigation:</strong>
            {% for error in investigation.errors %}
            <div class="error-item">• {{ error }}</div>
            {% endfor %}
        </div>
        <p style="margin-top: 15px; font-size: 10pt; color: #6b7280;">
            These limitations may affect the completeness of the investigation. Consider re-running the investigation when all data sources are available.
        </p>
    </div>
    {% endif %}
    
    <div class="disclaimer">
        <strong>Disclaimer:</strong> This report is generated by automated OSINT collection and analysis. All information should be independently verified before taking any action. The information contained in this report is for research and intelligence purposes only.
    </div>
    
    <div class="footer">
        <div>Generated by Enterprise OSINT Platform</div>
        <div>Report generated on {{ generation_date }}</div>
        <div style="margin-top: 10px;">
            🔒 This report contains sensitive intelligence information. Handle with appropriate security measures.
        </div>
    </div>
</body>
</html>